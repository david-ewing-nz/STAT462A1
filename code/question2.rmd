## Data Preparation

### Data Load and Variable Rename

```{r}
# load the dataset 'income.csv' into r as a data frame called 'income_dataset'
zip_path <- "../data/datasets.zip"
file.exists(zip_path)
income_dataset <- read.csv(unz(zip_path, "income.csv"))
# data column name exploration 
str(income_dataset)

# remove unnecessary columns and rename the feature names as `income` and `children`.
income <- income_dataset$Total.Household.Income
children <- income_dataset$Members.with.age.5...17.years.old
```

### Data Validation And Cleaning

```{r}
# check for missing values
cat("Number of missing values in Household Income:", sum(is.na(income)), "\n")
cat("Number of missing values in Number of Children:", sum(is.na(children)), "\n")

# summaries of variables
cat("\nSummary of Household Income:\n", 
    paste(names(summary(income)), summary(income), sep = " = ", collapse = "\n"), "\n\n")

cat("Summary of Number of Children:\n", 
    paste(names(summary(children)), summary(children), sep = " = ", collapse = "\n"), "\n")
```

### Scatter Plot Of Target Data

```{r}
# Scatter plot of income vs. children
plot(children, income/10000, xlab = "Number of Children", ylab = "Household Income (in 10 Thousands)", main = "Income vs. Children")
```

## Linear Regression

### Training Set And Testing Set Preparation

```{r}
# set a seed for reproducibility and reduce RAM pressure.
set.seed(888)  
# combine income and children into a data frame
data <- data.frame(income = income, children = children)
# split the data into training (80%) and test sets (20%)
train_data <- data[sample(1:nrow(data), size = 0.8 * nrow(data)), ] #	sample() is a function for random sampling. Its first argument is the object to be sampled, and its second argument, size, specifies how many elements to be sampled.
test_data <- data[-sample(1:nrow(data), size = 0.8 * nrow(data)), ]

```

### Model Training

```{r}
# fit a linear regression model
model <- lm(income ~ children, data = train_data)

# print the summary of the model
summary(model)

```

### Model Explanation

1.  What is the specific form of the affine-linear model, i.e.Â what are `b0` and `b1`?

-   The affine-linear model or SLR model (simple linear regression model) has the general form: $\text{income} = b_0 + b_1 \cdot \text{children}$

-   $b_0$ is the **intercept** (the value of income when children = 0). Our model's $b_0= 262735$

-   $b_1$ is the **slope** (the change in income for a one-unit increase in children). Our model's $b_1= -11256$

-   So the specific form of our SLR model is:

    $\text{income} = 262735 âˆ’11256 \cdot \text{children}$

2.  What is the predicted mean income of a household with $ð‘›$ children, for $\text{n} âˆˆ \{0,1,â€¦,8\}$? What are the associated 90% prediction intervals? Summarize all of this in a table.

    income of a household with $ð‘›$ children

```{r}
# library(xtable)
n <- array(0:8)
b_0 <- 262735
b_1 <- -11256
alpha <- 0.1
# tao <- 
predict_income_n <- b_0+b_1*n
true_mean_income_n <- tapply(df$income, df$n, mean) # ä½¿ç”¨ tapply() æŒ‰ n åˆ†ç»„å¹¶è®¡ç®—æ¯ç»„çš„å‡å€¼

df <- data.frame(n = n, predicted_income  = predict_income_n,
                 true_mean_income_n = true_mean_income_n
                 )

# åˆ›å»ºæ ¼å¼åŒ–çš„è¡¨æ ¼
ft <- flextable(df)
# æ‰“å°è¡¨æ ¼
ft

# cat(paste0("The predicted mean income of a household with 0-8 children = ",mean(income_n)),"\n")
```

When the sample number $\text{n}=8$, which is very small, we could .... (to be continue)

2.  Using your test set, check how many percent of datapoints lie within the 90% prediction intervals.
